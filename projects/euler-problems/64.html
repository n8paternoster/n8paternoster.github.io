<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Nathan Paternoster | Project Euler Problem 64</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/css/nate.css" />
    <link rel="stylesheet" type="text/css" href="/css/projects.css" />
    <noscript><link rel="stylesheet" type="text/css" href="/css/no-js.css" /></noscript>
    <script src="/js/nate.js" defer></script>
    <script src="https://kit.fontawesome.com/254df2922f.js" crossorigin="anonymous"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <div id="page-wrapper">

        <!-- Top navigation bar -->
        <ul class="topnav">
            <li><a href="/index.html">Nathan Paternoster</a></li>
            <li><a href="/coursework.html">Coursework</a></li>
            <li><a href="/projects.html">Projects</a></li>
            <li><a href="/recordings.html">Recordings</a></li>
            <li><a href="/contact.html">Contact</a></li>
        </ul>

        <!-- Page content -->
        <div class="content">
            <div class="euler-problem-link-container">
                <a href="../euler.html" class="back-link"><i class="fas fa-arrow-left"></i>&nbsp;Back to Problems</a>
                <div class="euler-problem-links">
                    <a href="https://projecteuler.net/problem=64" target="_blank"><i class="fas fa-link"></i>&nbsp;Problem 64 on Project Euler</a>
                    <a href=""<!--GITHUB LINK--> target="_blank"><i class="fas fa-code"></i>&nbsp;Problem 64 Code</a>
                </div>
            </div>
            <h1 id="euler-problem-title">Problem 64 - Odd period square roots</h1>
            <div class="euler-problem-view">
                <button class="accordion" type="button">View problem</button>
                <div class="accordion-panel">
                    <blockquote cite="https://projecteuler.net/problem=64">
                        <p>All square roots are periodic when written as continued fractions and can be written in the form:</p>
                        \(\displaystyle \quad \quad \sqrt{N}=a_0+\frac 1 {a_1+\frac 1 {a_2+ \frac 1 {a3+ \dots}}}\)
                        <p>For example, let us consider \(\sqrt{23}:\)</p>
                        \(\quad \quad \sqrt{23}=4+\sqrt{23}-4=4+\frac 1 {\frac 1 {\sqrt{23}-4}}=4+\frac 1  {1+\frac{\sqrt{23}-3}7}\)
                        <p>If we continue we would get the following expansion:</p>
                        \(\displaystyle \quad \quad \sqrt{23}=4+\frac 1 {1+\frac 1 {3+ \frac 1 {1+\frac 1 {8+ \dots}}}}\)
                        <p>The process can be summarised as follows:</p>
                        <p>
                            \(\quad \quad a_0=4, \frac 1 {\sqrt{23}-4}=\frac {\sqrt{23}+4} 7=1+\frac {\sqrt{23}-3} 7\)<br />
                            \(\quad \quad a_1=1, \frac 7 {\sqrt{23}-3}=\frac {7(\sqrt{23}+3)} {14}=3+\frac {\sqrt{23}-3} 2\)<br />
                            \(\quad \quad a_2=3, \frac 2 {\sqrt{23}-3}=\frac {2(\sqrt{23}+3)} {14}=1+\frac {\sqrt{23}-4} 7\)<br />
                            \(\quad \quad a_3=1, \frac 7 {\sqrt{23}-4}=\frac {7(\sqrt{23}+4)} 7=8+\sqrt{23}-4\)<br />
                            \(\quad \quad a_4=8, \frac 1 {\sqrt{23}-4}=\frac {\sqrt{23}+4} 7=1+\frac {\sqrt{23}-3} 7\)<br />
                            \(\quad \quad a_5=1, \frac 7 {\sqrt{23}-3}=\frac {7 (\sqrt{23}+3)} {14}=3+\frac {\sqrt{23}-3} 2\)<br />

                            \(\quad \quad a_6=3, \frac 2 {\sqrt{23}-3}=\frac {2(\sqrt{23}+3)} {14}=1+\frac {\sqrt{23}-4} 7\)<br />
                            \(\quad \quad a_7=1, \frac 7 {\sqrt{23}-4}=\frac {7(\sqrt{23}+4)} {7}=8+\sqrt{23}-4\)<br />
                        </p>
                        <p>It can be seen that the sequence is repeating. For conciseness, we use the notation \(\sqrt{23}=[4;(1,3,1,8)]\), to indicate that the block (1,3,1,8) repeats indefinitely.</p>
                        <p>The first ten continued fraction representations of (irrational) square roots are:</p>
                        <p>
                            \(\quad \quad \sqrt{2}=[1;(2)]\), period=\(1\)<br />
                            \(\quad \quad \sqrt{3}=[1;(1,2)]\), period=\(2\)<br />
                            \(\quad \quad \sqrt{5}=[2;(4)]\), period=\(1\)<br />
                            \(\quad \quad \sqrt{6}=[2;(2,4)]\), period=\(2\)<br />
                            \(\quad \quad \sqrt{7}=[2;(1,1,1,4)]\), period=\(4\)<br />
                            \(\quad \quad \sqrt{8}=[2;(1,4)]\), period=\(2\)<br />
                            \(\quad \quad \sqrt{10}=[3;(6)]\), period=\(1\)<br />
                            \(\quad \quad \sqrt{11}=[3;(3,6)]\), period=\(2\)<br />
                            \(\quad \quad \sqrt{12}=[3;(2,6)]\), period=\(2\)<br />
                            \(\quad \quad \sqrt{13}=[3;(1,1,1,1,6)]\), period=\(5\)
                        </p>
                        <p>Exactly four continued fractions, for \(N \le 13\), have an odd period.</p>
                        <p>How many continued fractions for \(N \le 10\,000\) have an odd period?</p>
                    </blockquote>
                </div>
            </div>
            <hr />
            <section>
                <h2>Simple Continued Fractions</h2>
                <p>Before tackling this problem it's necessary to understand continued fractions and their notation. In the most basic terms, a continued fraction is a way of writing fractions that include nested fractions such as:</p>
                <img style="max-height:200px" title="continued-fraction" src="/project-assets/euler/continued-fraction.png" />
                <p>They are commonly used as a way to represent rational numbers. For example, consider the rational number 415/93. A normal decimal approximation may be rounded and given as 4.4624. Instead, we can represent the number as a continued fraction by using an iterative process of repeated division. At each iteration we will perform Euclidean division to get an integer quotient and then use that to find the fractional remainder. The first iteration gives:</p>
                <div class="mathjax-block">
                    <p>\(\frac{415}{93} = 4 + \frac{43}{93}\)</p>
                </div>
                <p>For each subsequent iteration, take the reciprocal of the fractional remainder and repeat the above division. The next few iterations are:</p>
                <div class="mathjax-block">
                    <p>\(\frac{93}{43} = 2 + \frac{7}{43}\)</p><br />
                    <p>\(\frac{43}{7} = 6 + \frac{1}{7}\)</p><br />
                    <p>\(\frac{7}{1} = 7 + 0\) (iteration stops)</p>
                </div>
                <p>At each step we are <i>approximating</i> the value of the previous fraction with (the reciprocal of) an integer. For instance:</p>
                <div class="mathjax-block">
                    <p>\(\frac{415}{93} \approx 4\)</p><br />
                    <p>\(\frac{43}{93} \approx\) (the reciprocal of) \(2\)</p><br />
                    <p>\(\frac{7}{43} \approx\) (the reciprocal of) \(6\)</p><br />
                    <p>\(\frac{1}{7} = \) (the reciprocal of) \(7\)</p>
                </div>
                <p>We can use these integer approximations to write our continued fraction representation as:</p>
                <div class="mathjax-block">
                    <p>\(\frac{415}{93} = 4 + \frac{1}{2 + \frac{1}{6 + \frac{1}{7}}}\)</p>
                </div>
                <p>This form of continued fraction where every numerator is 1 is called a <b>simple continued fraction</b> or said to be in <b>canonical form</b>. Since all of the numerators are the same, another more concise way to write simple continued fractions (using the above as an example) is:</p>
                <div class="mathjax-block">
                    <p>\(\frac{415}{93} = [4; 2, 6, 7]\)</p>
                </div>
                <p>Those integer values (4, 2, 6, 7) are called the <em>coefficients</em> of the continued fraction.</p>
            </section>
            <section>
                <h2>Periodic Continued Fractions</h2>
                <p>When a continued fraction terminates (as in the above example) it is called a <b>finite continued fraction</b>. In addition to finite continued fractions, there are <b>periodic continued fractions</b> that don't terminate but instead repeat indefinitely. It's been shown that <i>every</i> irrational square root can be represented as a periodic continued fraction. Take for example \(\sqrt{3}\). As given by the problem, \(\sqrt{3}\) has the following continued fraction representation:</p>
                <div class="mathjax-block">
                    <p>\(\sqrt{3} = [1; (1, 2)] = [1; 1, 2, 1, 2, 1, 2, ...]\)</p>
                </div>
                <p>where the parentheses indicate that the coefficients 1 and 2 repeat indefinitely. This continued fraction has a period of length 2.</p>
                <p>So then the crux of the problem is finding and implementing an iterative algorithm, analagous to the one above, that gives us the periodic continued fraction of square roots. One such algorithm is as follows:</p>
                <div class="mathjax-block">
                    <p>\(\sqrt{S} = [a_0; a_1, a_2, ...]\)</p>
                    <p>(1) Initialize \(p_0 = 0, q_0 = 1, a_0 = \lfloor\sqrt{S}\rfloor\)</p>
                    <p>(2) \(p_{n+1} = q_na_n - p_n\)</p>
                    <p>(3) \(q_{n+1} = \frac{(S - p_{n+1}^2)}{q_n}\)</p>
                    <p>(4) \(a_{n+1} = \lfloor\frac{(a_0 + p_{n+1})}{q_{n+1}}\rfloor\)</p>
                    <p>(5) Increment n and go back to (2)</p>
                </div>
                <p>This algorithm can be demonstrated with the example given in the problem. In each iteration we are splitting the current value into an integer and a fraction part. The integer becomes the coefficient <i>a<sub>n</sub></i> of that iteration and the <i>inverse</i> of the fraction part becomes the value for the next iteration. This has the effect of producing finer and finer approximations of our initial number.</p>
                <p>For example, the first iteration of \(\sqrt{23}\) is</p>
                <div class="mathjax-block">
                    <p>Split \(\sqrt{23}\) into an integer part and a fraction part:</p><br />
                    <p>\(\sqrt{23} \approx 4\) (integer part, \(a_0\))</p>
                    <p>the amount left over is \(\sqrt{23}-4\) (fraction part)</p><br />
                    <p>Take the inverse of the fraction part and simplify:</p>
                    <p>\(\frac{1}{\sqrt{23}-4} \cdot \frac{\sqrt{23}+4}{\sqrt{23}+4} = \frac{\sqrt{23}+4}{23-16} = \frac{\sqrt{23}+4}{7}\)</p>
                </div>
                <p>Taking \(\frac{\sqrt{23}+4}{7}\) as our new value, this is the second iteration:</p>
                <div class="mathjax-block">
                    <p>Split \(\frac{\sqrt{23}+4}{7}\) into an integer part and a fraction part:</p><br />
                    <p>we've already seen that \(\sqrt{23}\approx4\), so using this approximation,</p>
                    <p>\(\frac{\sqrt{23}+4}{7} \approx \frac{4+4}{7} \approx 1\) (integer part, \(a_1\))</p>
                    <p>and the amount left over is \(\frac{\sqrt{23}+4}{7}-1\) (fraction part)</p><br />
                    <p>Simplify and take the inverse of the fraction part:</p>
                    <p>\(\frac{\sqrt{23}+4}{7}-1 = \frac{\sqrt{23}+4}{7}-\frac{7}{7} = \frac{\sqrt{23}-3}{7} \rightarrow \frac{7}{\sqrt{23}-3}\) (inverse)</p>
                </div>
                <p>For irrational square roots, this process will repeat forever. One key insight that helps us detect when to stop this algorithm is given by mathematician <a class="wiki-link-inline" href="https://en.wikipedia.org/wiki/%C3%89variste_Galois" target="_blank">Évariste Galois</a>. One of the derived results of his papers states that</p>
                <div class="mathjax-block">
                    <p>\(\sqrt{S} = [a_0; (a_1, a_2, ..., a_2, a_1, 2a_0)]\)</p>
                </div>
                <p>This says that every irrational square root, S, will have a periodic continued fraction representation whose coefficients form a palindrome after <i>a<sub>0</sub></i> and contain a final coefficient of twice <i>a<sub>0</sub></i>. For further reading on the math leading to this result, a good place to start is the wiki page on <a class="wiki-link-inline" href="https://en.wikipedia.org/wiki/Periodic_continued_fraction" target="_blank">Periodic continued fractions</a>. However, for our purposes, this observation tells us that we can terminate the algorithm when we run into a coefficient <i>a<sub>n</sub></i> that is equal to 2*<i>a<sub>0</sub></i>. </p>
            </section>
            <section>
                <h2>Implementation</h2>
                <code>
                    <pre>
int numOddPeriods(int N) {
&#9;int count = 0;
&#9;for (int n = 2; n &lt;= N; n++) {
&#9;&#9;int a0 = (int)sqrt(n);
&#9;&#9;if (a0*a0 == n) continue;
&#9;&#9;int p = 0, q = 1, a = a0, periodLength = 0;
&#9;&#9;do {
&#9;&#9;&#9;p = a*q - p;
&#9;&#9;&#9;q = (n - p*p) / q;
&#9;&#9;&#9;a = (a0 + p) / q;
&#9;&#9;&#9;periodLength++;
&#9;&#9;} while (a != 2*a0);
&#9;&#9;if (periodLength%2) count++;
&#9;}
&#9;return count;
}</pre>
                </code>
                <p>In the outer loop we check all of the integers up to 10,000 and increment <i>count</i> when an integer has an odd period length. In the inner while loop is the implementation of the algorithm listed above. This function makes use of the fact that in C++ positive integer division results in truncation of the quotient.</p>
            </section>
            <div id="end-page-links">
                <a href="/projects/euler-problems/63.html" id="prev-problem"><i class="fas fa-arrow-left"></i>&nbsp;Previous: Powerful digit counts</a>
                <a href="/projects/euler-problems/75.html" id="next-problem">Next: Singular integer right triangles&nbsp;<i class="fas fa-arrow-right"></i></a>
            </div>
        </div>

        <div id="push"></div>
    </div>

    <!-- Footer -->
    <footer>
        <p>Website &copy; <span id="year">2020</span> Nathan Paternoster</p>
        <script>
            var d = new Date();
            document.getElementById("year").innerHTML = d.getFullYear();
        </script>
    </footer>
</body>
</html>